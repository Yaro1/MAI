<html><head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r"><title>Руководство по ассемблеру NASM</title>

<META NAME="GENERATOR" CONTENT="Super-Puper-Mega-Proga"></head>
<body bgcolor="#DDE1C2"><b><a href="http://www.opennet.ru/docs/">Архив документации OpenNet.ru</a> / 
Раздел "<a href="http://www.opennet.ru/docs/124.shtml">Программирование, языки</a>" /
<a href="index.html">Индекс</a>
</b>
<hr noshade size=1>

<h1 align=center>Расширенный ассемблер: NASM</h1>

<p align=center><a href="nasm_ru3.html">Следующая глава</a> | <a href="nasm_ru1.html">Предыдущая 
  глава</a> | <a href="contents.html">Содержание</a> | Указатель
</p>
<p align=center>&nbsp;</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="60%"> 
      <h2><a name="chapter-2">Глава 2: Запуск NASM</a></h2>
    </td>
    <td>
      <div align="right"><font size="-1" color="#666666">Перевод: <a href="http://asmdev.narod.ru/asmos.html">AsmOS 
        group</a>, &copy; 2001</font></div>
    </td>
  </tr>
</table>
<h3><a name="section-2.1">2.1 Синтаксис командной строки NASM</a></h3>
<p>Для ассемблирования файла вы должны ввести следующую команду: </p>
<pre><font color="#666666">     nasm -f &lt;format&gt; &lt;filename&gt; [-o    &lt;output&gt;]</font></pre>
<p>Например, </p>
<pre><font color="#666666">     nasm -f elf myfile.asm</font></pre>
<p>будет ассемблировать <font color="#000099">myfile.asm</font> в ELF-объектный 
  файл <font color="#000099">myfile.o</font>. А строка </p>
<pre>     <font color="#666666">nasm -f bin myfile.asm -o myfile.com</font></pre>
<p>будет ассемблировать <font color="#000099">myfile.asm</font> в обычный бинарный 
  файл <font color="#000099">myfile.com</font>. <br>
  Для получения файла-листинга, содержащего слева от оригинального исходного текста 
  шестнадцатиричные коды, генерируемые NASM, используйте ключ <font color="#000099">-l</font>, 
  обозначающий имя файла-листинга, например: </p>
<pre><font color="#666666" size="2"> </font><font color="#666666">    nasm -f coff myfile.asm -l myfile.lst </font></pre>
<p>Для получения справки по командной строке NASM, укажите следующий ключ: </p>
<pre><font color="#666666" size="2">     </font><font color="#666666">nasm -h</font> </pre>
<p>При этом вы получите также список доступных форматов выходных файлов и что 
  они означают. Если вы используете Linux, но не уверены, какая ваша система &#151; 
  <font color="#000099">a.out</font> или <font color="#000099">ELF</font>, введите 
</p>
<pre><font color="#666666" size="2">     </font><font color="#666666">file nasm</font></pre>
<p>в каталоге, где находятся бинарные файлы NASM. В ответ вы получите что-то вроде</p>
<pre><font color="#666666">     nasm: ELF 32-bit LSB executable i386 (386 and up) Version    1</font></pre>
<p>Это означает, что ваша система &#151; ELF и вы должны при ассемблировании использовать 
  ключ <font color="#000099">-f elf</font>. Если же вы увидите</p>
<pre><font color="#666666" size="2"> </font><font color="#666666">    nasm: Linux/i386 demand-paged executable (QMAGIC)</font></pre>
<p>или что-то наподобие этого, ваша система &#151; <font color="#000099">a.out</font>, 
  и при ассемблировании нужно будет указать ключ <font color="#000099">-f aout</font>. 
  (Linux системы <font color="#000099">a.out</font> считаются устаревшими и на 
  сегодняшний день встречаются редко). <br>
  Подобно Unix компиляторам и ассемблерам, NASM "бесшумен": вы не будете видеть 
  никаких сообщений вообще, если только это не сообщения об ошибках. </p>
<h4><a name="section-2.1.1">2.1.1 Ключ<font color="#000099"> -o</font>: Указание 
  имени выходного файла</a></h4>
<p>Обычно NASM выбирает имя выходного файла самостоятельно; так как это зависит 
  от формата объектного файла. Если формат объектного файла &#151; Microsoft (<font color="#000099">obj</font> 
  и <font color="#000099">win32</font>), он удалит расширение <font color="#000099">.asm</font> 
  (или любое другое, какое вам нравится использовать &#151; NASMу все равно) из 
  имени исходного файла и заменит его на <font color="#000099">.obj</font>. У 
  объектных файлов Unix-формата (<font color="#000099">aout, coff, elf</font> 
  и <font color="#000099">as86</font>) он будет заменять расширение на <font color="#000099">.o</font>. 
  Для формата <font color="#000099">rdf</font> он будет использовать расширение 
  <font color="#000099">.rdf</font>, а в случае формата <font color="#000099">bin</font> 
  он просто удалит расширение, например из <font color="#000099">myfile.asm</font> 
  получится файл <font color="#000099">myfile</font>. </p>
<p>Если выходной файл уже существует, NASM перезапишет его, если только его имя 
  не совпадает с именем входного файла &#151; в этом случае появится предупреждение 
  и в качестве выходного файла будет использовано имя <font color="#000099">nasm.out</font>.</p>
<p>В случаях, когда имя по умолчанию недопустимо, используйте ключ <font color="#000099">-o</font> 
  командной строки, позволяющий определить необходимое вам имя выходного файла. 
  Имя выходного файла должно следовать за ключем <font color="#000099">-o</font>, 
  неважно с пробелом между ними или без. Например:</p>
<blockquote> 
  <pre><font color="#666666">nasm -f bin program.asm -o program.com <br>nasm -f bin driver.asm    -odriver.sys</font> </pre>
</blockquote>
<h4><a name="section-2.1.2">2.1.2 Ключ <font color="#000099">-f</font>: Указание 
  формата выходного файла</a></h4>
<p>Если ключ <font color="#000099">-f</font> в командной строке отсутствует, NASM 
  будет выбирать формат выходного файла самостоятельно. В распространяемой версии 
  NASM формат по умолчанию всегда <font color="#000099">bin</font>; если вы создаете 
  собственную копию NASM, то при компиляции можете переопределить значение <font color="#000099">OF_DEFAULT</font> 
  на то, которое вам нужно по умолчанию. </p>
<p>Как и для ключа <font color="#000099">-o</font>, разделительный пробел между 
  <font color="#000099">-f</font> и форматом выходного файла необязателен: <font color="#000099">-f 
  elf</font> и <font color="#000099">-felf</font> для NASM идентичны.</p>
<p><font size="2" face="Verdana, Arial, Helvetica">Полный список доступных выходных 
  форматов может быть получен при помощи команды <font color="#000099">nasm -h</font>. 
  </font></p>
<h4><a name="section-2.1.3">2.1.3 Ключ <font color="#000099">-l</font>: Генерация 
  файла-листинга</a></h4>
<p>Если в командной строке вы укажете ключ <font color="#000099">-l</font> и имя 
  файла (как обычно, пробел необязателен), NASM будет генерировать из исходника 
  файл-листинг, где адреса и генерируемый код будут расположены слева, а исходный 
  код с развернутыми многострочными макросами (за исключением тех, которые специально 
  требуют обратное: см. <a href="nasm_ru4.html#section-4.2.9">параграф 4.2.9</a>) 
  &#151; справа. Например: 
<blockquote> 
  <pre><font color="#666666">nasm -f elf myfile.asm -l myfile.lst </font></pre>
</blockquote>
<h4><a name="section-2.1.4">2.1.4 Ключ <font color="#000099">-E</font>: </a>Перенаправление 
  ошибок в файл</h4>
<p>Под MS-DOS перенаправление стандартного потока ошибок в файл может быть сопряжено 
  с трудностями (хотя способы имеются). Так как NASM обычно направляет предупреждения 
  и сообщения об ошибках в поток <font color="#000099">stderr</font>, перехват 
  этих сообщений ( например для последующего просмотра в редакторе) может вызвать 
  сложности. </p>
<p><font size="2" face="Verdana, Arial, Helvetica">В связи с этим имеется специальный 
  ключ <font color="#000099">-E</font>, после которого указывается имя файла (пробел 
  необязателен). Данный ключ перенаправляет стандартный поток ошибок в указанный 
  файл. Таким образом, вы можете запустить NASM, например следующим образом:</font></p>
<blockquote> 
  <pre><font color="#666666">nasm -E myfile.err -f obj myfile.asm </font></pre>
</blockquote>
<h4><a name="section-2.1.5">2.1.5 Ключ <font color="#000099">-s</font>: Перенаправление 
  ошибок в <font color="#000099">stdout</font></a></h4>
<p>Ключ <font color="#000099">-s</font> перенаправляет стандартный поток ошибок 
  <font color="#000099">stderr</font> в выходной поток <font color="#000099">stdout</font> 
  (естественно, в MS-DOS). Например, для ассемблирования файла <font color="#000099">myfile.asm</font> 
  и передачи ошибок программе <font color="#000099">more</font>, вы можете ввести 
  следующее: 
<p> 
<blockquote> 
  <pre><font color="#666666">nasm -s -f obj myfile.asm | more</font></pre>
</blockquote>
<p>См. также ключ <font color="#000099">-E</font>, <a href="#section-2.1.4">параграф 
  2.1.4</a>. 
<h4><a name="section-2.1.6">2.1.6 Ключ <font color="#000099">-i</font>: </a>Каталоги 
  поиска включаемых файлов</h4>
<p>Когда NASM встречает в исходнике директиву <font color="#000099">%include</font> 
  (см. <a href="nasm_ru4.html#section-4.5">параграф 4.5</a>), он будет искать указанный 
  в ней файл не только в текущем каталоге, но и во всех каталогах, указанных в 
  командной строке при помощи ключа <font color="#000099">-i</font>. Следовательно, 
  вы можете включить файлы из, например, библиотеки макросов, введя следующую 
  команду: 
<blockquote><pre>
<font color="#666666">nasm -ic:\macrolib\ -f obj myfile.asm</font>
</pre></blockquote>
  
<p>(Как обычно, пробел между <font color="#000099">-i</font> и строкой поиска 
  допустим, но не обязателен) </p>
<p>С целью переносимости кода в NASMе не "зашито" соглашение об именовании файлов 
  той или иной ОС, под которой он запущен; строка, которую вы укажете как аргумент 
  ключа, будет обработана в точности так, как есть. Заключительный обратный слэш 
  в приведенном выше примере под Unix необходим, т.к. в этой ОС заключительные 
  слэши обычно требуются.</p>
<p>(Вы можете извлечь из этого обстоятельства выгоду, использовав данный ключ 
  "не по назначению" &#151; например ключ <font color="#000099">-ifoo</font> будет 
  заставлять директиву <font color="#000099">%include "bar.i"</font> искать файл 
  <font color="#000099">foobar.i...</font>) </p>
<p>Если вы хотите описать <i>стандартный</i> путь поиска включаемых файлов, такой 
  как <font color="#000099">/usr/include</font> в системе Unix, вы должны поместить 
  одну или более директив <font color="#000099">-i</font> в переменную окружения 
  <font color="#000099">NASM</font> (см. <a href="#section-2.1.13">параграф 2.1.13</a>). 
</p>
<p>Для совместимости с make-файлами большинства С компиляторов, данный ключ может 
  быть также задан как <font color="#000099">-I</font>. </p>

  <h4><a name="section-2.1.7">2.1.7 Ключ <font color="#000099">-p</font>: Предварительно 
  включаемые файлы</a></h4>
<p>При помощи ключа <font color="#000099">-p</font> NASM позволяет вам <i>предварительно</i> 
  включить некоторые файлы в ваш исходник. Так, строка запуска 
<p>
<blockquote>
  <pre><font color="#666666">nasm myfile.asm -p myinc.inc</font></pre>
</blockquote>
<p>эквивалентна строке <font color="#000099">nasm myfile.asm</font> и помещением 
  в начало файла директивы <font color="#000099">%include "myinc.inc"</font>. 
  В целях симметричности с ключами <font color="#000099">I, -D</font> и <font color="#000099">-U</font> 
  данный ключ может быть также задан как <font color="#000099">-P</font>. 
<h4><a name="section-2.1.8">2.1.8 Ключ <font color="#000099">-d</font>: Предопределение 
  макроса</a></h4>
<p>Аналогично тому, как ключ <font color="#000099">-p</font> дает альтернативу 
  помещения в начало исходного файла директивы <font color="#000099">%include</font>, 
  ключ <font color="#000099">-d</font> дает альтернативу директиве <font color="#000099">%define</font>. 
  Таким образом, команда 
<blockquote>
  <pre><font color="#666666">nasm myfile.asm -dFOO=100</font></pre>
  </blockquote>
<p>альтернативна помещению в начало файла директивы 
<blockquote>
  <pre><font color="#666666">%define FOO 100</font></pre>
  </blockquote>
<p>Вы можете также опустить значение константы: ключ <font color="#000099">-dFOO</font> 
  эквивалентен строке <font color="#000099">%define FOO</font>. Данная возможность 
  может быть полезна при ассемблировании для включения/выключения опций, проверяемых 
  при помощи директивы <font color="#000099">%ifdef</font>, например <font color="#000099">-dDEBUG</font>. 
  Для совместимости с make-файлами большинства С компиляторов, данный ключ может 
  быть также задан как <font color="#000099">-D</font>. 
<h4><a name="section-2.1.9">2.1.9 Ключ <font color="#000099">-u</font>: </a>Отмена 
  определения макроса</h4>
<p> Ключ <font color="#000099">-u</font> отменяет определение ранее определенного 
  макроса. Например, в результате выполнения следующей командной строки: 
<p>
<blockquote>
  <pre><font color="#666666">nasm myfile.asm -dFOO=100 -uFOO</font></pre>
</blockquote>
<p>FOO <i>не будет</i> предопределенным макросом для программы. Это полезно для 
  временного отключения опций, заданных в make-файлах. Для совместимости с make-файлами 
  большинства С компиляторов, данный ключ может быть также задан как <font color="#000099">-U</font>. 
<h4><a name="section-2.1.10">2.1.10 Ключ <font color="#000099">-e</font>: Только 
  препроцессирование</a></h4>
<p>NASM допускает выполнение только препроцессирования входного файла. Использование 
  ключа <font color="#000099">-e</font> (не требующего параметров) заставит NASM 
  препроцессировать входной файл, развернуть все макро ссылки, удалить все комментарии 
  и директивы препроцессора и вывести результирующий файл в стандартный выходной 
  поток (или сохранить его как отдельный файл, если используется также опция <font color="#000099">-о</font>). 
<p>Данный ключ неприменим для программ, где препроцессор должен вычислить выражения, 
  зависящие от значений адресов: такой код как 
<p>
<blockquote>
  <pre><font color="#666666">%assign tablesize ($-tablestart)</font></pre>
</blockquote>
<p>будет вызывать ошибку в режиме "только препроцессирование". 
<h4><a name="section-2.1.11">2.1.11 Ключ -a: </a>Отключение препроцессора</h4>
<p>Если NASM используется в качестве выходной части компилятора, то для увеличения 
  скорости компиляции желательно полностью подавить препроцессирование в случае, 
  если компилятор уже делает его. Ключ <font color="#000099">-a</font>, не требующий 
  никаких параметров, заставляет NASM заменить свой препроцессор ничего не делающей 
  "заглушкой". 
<h4><a name="section-2.1.12">2.1.12 Ключ -w: </a>Разрешение/Запрещение предупреждений 
  при ассемблировании</h4>
<p>В процессе ассемблирования NASM может замечать множество вещей, заслуживающих 
  внимания пользователя, но не представляющих собой таких серьезных ошибок, чтобы 
  NASM не смог сгенерировать выходной файл. Эти предупреждения выдаются так же, 
  как и ошибки, но перед собственно сообщением добавляется слово "warning". Предупреждения 
  не являются причиной прерывания процесса генерации выходного файла. 
<p>Некоторые события менее серьезны, чем другие: они только иногда заслуживают 
  внимания пользователя. В связи с вышесказанным, NASM поддерживает ключ командной 
  строки <font color="#000099">-w</font>, включающий или выключающий определенные 
  классы предупреждений. Эти классы предупреждений описываются по имени, например 
  <font color="#000099">orphan-labels</font>; вы можете разрешить предупреждения 
  данного класса при помощи ключа <font color="#000099">-w+orphan-labels</font> 
  и запретить их ключом <font color="#000099">-w-orphan-labels</font>. 
<p>Ниже перечислены классы подавляемых предупреждений: 
<ul>
  <li><font  color="#000099">macro-params</font> 
    включает предупреждения о многострочных макросах, которым передается неверное 
    число параметров. Данный класс предупреждений по умолчанию разрешен; см. <a href="nasm_ru4.html#section-4.2.1">параграф 
    4.2.1</a>, где приведен пример отключения этого класса. 
  <li><font  color="#000099">orphan-labels</font> 
    включает предупреждения о строках исходника, не содержащих инструкций, но 
    в которых описываются метки без завершающего двоеточия. NASM по умолчанию 
    не предупреждает об этих вещах; см. пример в <a href="nasm_ru3.html#section-3.1">параграфе 
    3.1</a>, где показано, как можно включить их. 
  <li><font face="Verdana, Arial, Helvetica" size="2" color="#000099">number-overflow</font> 
    включает предупреждения о числовых константах, не вписывающихся в диапазон 
    32 бита (0x7fffffff). Данный класс предупреждений по умолчанию разрешен. 
</ul>
<h4><a name="section-2.1.13">2.1.13 Переменная окружения <font color="#000099">NASM</font></a></h4>
<p>Если вы определите переменную окружения NASM, программа будет интерпретировать 
  ее как список дополнительных ключей командной строки, обрабатывающихся <i>раньше</i> 
  "настоящих" параметров командной строки. Вы можете использовать эту возможность, 
  например для описания стандартных каталогов поиска включаемых файлов, поместив 
  в пременную <font color="#000099">NASM</font> ключ <font color="#000099">-i</font>. 
</p>
<p>Значение пременной разделяется пробелами, поэтому значение <font color="#000099">-s 
  -ic:\nasmlib</font> будет обработано как два отдельных ключа. В то же время 
  значение <font color="#000099">-dNAME="my name"</font> не будет воспринято так, 
  как вы хотите (внутри есть пробел) и командный процессор NASMа соответственно 
  не поймет двух бессмысленных параметров <font color="#000099">-dNAME="my</font> 
  и <font color="#000099">name"</font>.</p>
<p>Для разрешения этого введено следующее правило: если вы начинаете переменную 
  <font color="#000099">NASM</font> некоторым символом, не являющимся знаком "минус", 
  NASM будет воспринимать этот символ как разделитель опций. Таким образом, значение<br>
  <font color="#000099">!-s!-ic:\nasmlib</font> переменной <font color="#000066">NASM</font> 
  эквивалентно <font color="#000099">-s -ic:\nasmlib</font>, но зато теперь <font color="#000066">!-dNAME="my 
  name"</font> будет работать правильно. </p>
<h3><a name="section-2.2">2.2 Пользователям MASM: Отличия</a></h3>
<p>Если вы использовали для написания программ <font color="#000099">MASM</font>, 
  или <font color="#000099">TASM</font> в режиме совместимости с MASM, или <font color="#000099">a86</font>, 
  прочитайте данный раздел, в котором приводятся основные отличия синтаксиса MASM 
  и NASM. Если же вы вообще не использовали раньше MASM, просто пропустите этот 
  раздел и читайте дальше. 
<h4><a name="section-2.2.1">2.2.1 NASM чувствителен к регистру символов</a></h4>
<p>Самым "простым" отличием является регистро-чувствительность NASM &#151; он 
  различает обращения к таким меткам, как <font color="#000099">foo, Foo</font> 
  или <font color="#000099">FOO</font>. Если вы ассемблируете <font color="#000099">.obj</font>-файлы 
  для DOS или OS/2, то для перевода всех экспортируемых в другие модули символов 
  в верхний регистр можете активизировать директиву <font color="#000099">UPPERCASE</font> 
  (описана в <a href="nasm_ru6.html#section-6.2">параграфе 6.2</a>). Однако <i>в 
  пределах</i> одного модуля NASM различает метки, отличающиеся друг от друга 
  только регистром. 
<h4><a name="section-2.2.2">2.2.2 NASM требует квадратные скобки для ссылок на 
  память</a></h4>
<p>NASM был разработан, кроме всего прочего, для упрощения запоминания синтаксиса. 
  Одна из целей проекта NASM состоит в том, чтобы везде, где это возможно, было 
  взаимно однозначное соответствие между отдельной строкой кода NASM и генерируемой 
  из нее инструкцией. В MASM вы этого сделать не можете: если определите, например, 
<p> 
<pre><font color="#666666">          foo       equ 1 
          bar       dw 2</font></pre>
<p>затем напишете две строки кода 
<p> 
<pre><font color="#666666">          mov ax,foo 
          mov ax,bar</font></pre>
<p>то будут сгенерированы две совершенно различных инструкции, несмотря на то, 
  что синтаксис на вид совершенно идентичен. 
<p>NASM уходит от этой нежелательной ситуации путем упрощения синтаксиса для ссылок 
  на память. Правило элементарно &#151; <i>любой</i> доступ к содержимому памяти 
  требует постановки квадратных скобок вокруг адреса, а при любом доступе к <i>адресу</i> 
  переменной квадратные скобки не ставятся. Таким образом, инструкция вида <font color="#000099">mov 
  ax,foo</font> будет <i>всегда</i> ссылаться на константу времени компиляции, 
  неважно <font color="#000099">EQU</font> ли это или адрес переменной, в то же 
  время для получения доступа к <i>содержимому</i> переменной <font color="#000099">bar</font> 
  вы должны использовать код <font color="#000099">mov ax,[bar]</font>. </p>
<p>Из этого также следует, что NASM не нуждается в ключевом слове MASMа <font color="#000099">OFFSET</font>, 
  т.к. MASMовский код <font color="#000099">mov ax,offset bar</font> означает 
  то же самое, что и <font color="#000099">mov ax,bar</font> для NASM. Если вы 
  накопили достаточно много кода, написанного под MASM и хотите использовать его 
  в NASMе, вы всегда можете вставить строчку вида <font color="#000099">%idefine 
  offset</font>, указывающую препроцессору, что ключевое слово <font color="#000099">OFFSET</font> 
  является ничего не делающей инструкцией.</p>
<p>Данное несоответствие еще в большей степени присутствует в <font color="#000099">a86</font>, 
  где объявление метки с завершающим двоеточием описывает собственно метку, а 
  без двоеточия &#151; переменную. Так, в <font color="#000099">a86</font> инструкция 
  <font color="#000099">mov ax,var</font> будет вести себя по разному, в зависимости 
  от объявления метки <font color="#000099">var</font>: как <font color="#000099">var: 
  dw 0</font> (это метка) или как <font color="#000099">var dw 0</font> (а это 
  уже переменная размером в слово). NASM по сравнению с этим очень прост: <i>все</i> 
  является метками.</p>
<p>NASM, в целях упрощения, не поддерживает гибридный синтаксис MASMа и его клонов, 
  такой, как например <font color="#000099">mov ax,table[bx]</font>, где ссылка 
  на память обозначена частью внутри квадратных скобок, а частью &#151; вне их. 
  Правильный синтаксис в NASM для указанной выше инструкции будет <font color="#000099">mov 
  ax,[table+bx]</font>. Соответственно, инструкция вида <font color="#000099">mov 
  ax,es:[di]</font> не поддерживается, правильная инструкция &#151; <font color="#000099">mov 
  ax,[es:di]</font>.</p>
<h4><a name="section-2.2.3">2.2.3 NASM не хранит типы переменных</a></h4>
<p>NASM не запоминает определямые вами типы переменных. Поскольку MASM эти вещи 
  запоминает, то при встрече <font color="#000099">var dw 0</font> он запомнит, 
  что вы определили <font color="#000099">var</font> как пременную размером в 
  слово и затем будет способен разрешить неопределенность при появлении инструкции 
  <font color="#000099">mov var,2</font>. NASM же преднамеренно не будет помнить 
  ничто относительно символа <font color="#000099">var</font> за исключением того, 
  где он начинается, поэтому вы должны явно указывать <font color="#000099">mov 
  word [var],2</font>. </p>
<p>В соответствии с этим, NASM не поддерживает инструкции <font color="#000099">LODS, 
  MOVS, STOS, SCAS, CMPS, INS</font> или <font color="#000099">OUTS</font>, поддерживаются 
  только их формы вида <font color="#000099">LODSB, MOVSW</font> и <font color="#000099">SCASD</font>, 
  где явно задается размер компонентов обрабатываемой строки. </p>
<h4><a name="section-2.2.4">2.2.4 NASM не поддерживает <font color="#000066">ASSUME</font></a></h4>
<p>Как часть общей идеологии упрощения, NASM не поддерживает директиву <font color="#000099">ASSUME</font>. 
  NASM не будет следить за тем, какие значения вы помещаете в сегментные регистры 
  и поэтому никогда <i>автоматически не будет</i> генерировать префикс замены 
  сегмента. 
<h4><a name="section-2.2.5">2.2.5 NASM не поддерживает модели памяти</a></h4>
<p>NASM не имеет никаких директив для поддержки различных 16-битных моделей памяти. 
  Программист должен самостоятельно следить, какие функции предполагается вызывать 
  "дальним вызовом", а какие &#151; ближним, и соответственно помещать правильную 
  форму инструкции <font color="#000099">RET</font> (<font color="#000099">RETN</font> 
  или <font color="#000099">RETF</font>; NASM допускает применение <font color="#000099">RET</font> 
  в качестве альтернативной формы <font color="#000099">RETN</font>); кроме того, 
  программист ответственен за кодирование инструкций <font color="#000099">CALL 
  FAR</font>, где это необходимо при вызове внешних функций, и должен также следить, 
  какие описания внешних переменных являются дальними, а какие &#151; ближними. 
<h4><a name="section-2.2.6">2.2.6 Различия в обработке чисел с плавающей точкой</a></h4>
<p>NASM, в отличие от MASM, использует другие имена для ссылок на регистры сопроцессора: 
  MASM ссылается на эти регистры как <font color="#000099">ST(0), ST(1)</font> 
  и т.д., в NASMе для этой цели используются имена <font color="#000099">st0, 
  st1</font> и т.д. </p>
<p>Начиная с версии 0.96, NASM обрабатывает инструкции форм "nowait" так же, как 
  и MASM-совместимые ассемблеры. Особая обработка, использованная в версиях 0.95 
  и младше была основана на неправильном понимании авторами. </p>
<h4><a name="section-2.2.7">2.2.7 Прочие различия</a></h4>
<p>По историческим причинам NASM использует ключевое слово <font color="#000099">TWORD</font> 
  там, где MASM и совместимые с ним ассемблеры используют <font color="#000099">TBYTE</font>. 
</p>
<p>NASM объявляет резервируемое пространство (неиницализированные данные) не так, 
  как MASM: там, где MASM-программист может написать <font color="#000099">stack 
  db 64 dup (?)</font>, NASM требует следующее &#151; <font color="#000099">stack 
  resb 64</font>, что интерпретируется как "резервирование 64 байт". Так как NASM 
  обрабатывает <font color="#000099">?</font> как обычный символ, вы можете написать 
  что-то вроде <font color="#000099">? equ 0</font>, а затем использовать <font color="#000099">dw 
  ?</font>, что будет возможно полезно для каких-то целей. <font color="#000099">DUP</font> 
  однако остается неподдерживаемым синтаксисом. </p>
<p>И, наконец, в дополнение ко всему вышесказанному, макросы и директивы NASM 
  работают совершенно отлично от MASM. Подробности приведены в <a href="nasm_ru4.html">главе 
  4</a> и <a href="nasm_ru5.html">главе 5</a>. </p>
<p align="center"><a href="nasm_ru3.html">Следующая глава</a> | <a href="nasm_ru1.html">Предыдущая 
  глава</a> | <a href="contents.html">Содержание</a> | Указатель
<hr noshade size=1>
<b><a href="http://www.opennet.ru/docs/">Архив документации на OpenNet.ru</a>
</body></html>
